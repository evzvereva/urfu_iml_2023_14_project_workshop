# Серверная часть проекта "Умный городской гид по Екатеринбургу"

Предоставлят API к большим языковым моделям (LLM) YandexGPT и Ollama. Является частью проекта "Умный городской гид по Екатеринбургу" и создан в рамках Проектной практики Подгруппы 14.

Сайт проекта доступен по [ссылке](https://urfu-iml-2023-14-project-workshop.streamlit.app/).

[YandexGPT](https://cloud.yandex.ru/services/yandexgpt) - находящаяся на этапе тестирования нейросеть семейства GPT от компании «Яндекс», которая генерирует тексты на основе данных из интернета.

[Ollama](https://ollama.ai/) - библиотека с открытым исходным кодом, которая позволяет запускать различные модели LLM на своих серверах. В данном проекте выбрана модель [Starling-7B](https://starling.cs.berkeley.edu/).

## Конечные точки API

- Корневая точка
- Документация (Swagger)
- Чат (формирование ответа пользователю)
- Просмотр логов сервера

## Корневая точка

```shell
GET /
```

Возвращает пустую строку. Требуется для проверки статуса сервера.

## Документация (Swagger)

```shell
GET /docs
```

## Чат (формирование ответа пользователю)

```shell
POST /chat
```

Формируется ответ пользователю с использованием больших языковых моделей YandexGPT и Ollama. Имеется возможность передачи предыдущих сообщений для учета контекста общения.

В первую очередь для формирования запроса используется API сервиса YandexGPT. В качестве резервной используется API библиотеки Ollama. Если при обращении к YandexGPT возникает ошибка (сервис работает в режиме Preview и иногда бывает недоступен, а также в сервисе установлено ограничение на количество запросов в час), то задействуется локальный сервис Ollama.

### Параметры

- `api_key`: (обязатеное поле) токен для авторизации
- `prompt`: (обязатеное поле) текст запроса пользователя
- `history`: сообщения чата в виде массива, используется для передачи истории общения, каждый элемент массива состоит из двух полей:
    * `role` - роль, возможные значения: `system`, `user`, `assistant`
    * `content` - текст сообщения, запрос для роли `user`, ответ для роли `assistant` и системный запрос для роли `system`
- `service`: сервисное поле, используется для выбора модели

### Примеры

#### Запрос

Отправка запроса пользователя.

```json
{
  "api_key": "API_KEY",
  "prompt": "Расскажи про город",
  "history": []
}
```

#### Ответ

```
Екатеринбург — административный центр Свердловской области России. Город расположен на восточном склоне Среднего Урала, на реке Исеть (притоке реки Тобол). Екатеринбург — один из крупнейших городов России, пятый по численности населения (1 419 972 человек на 1 января 2023 года) в её границах.\n\nЕкатеринбург — важный промышленный, культурный и научный центр Урала. В городе расположены более 700 предприятий чёрной и цветной металлургии, машиностроения, химической, лёгкой и пищевой промышленности. Екатеринбург является важным транспортным узлом: через город проходят железнодорожные и автомобильные магистрали, а также река Исеть, по которой осуществляется водное сообщение.\n\nЕкатеринбург — один из образовательных и научных центров России. В городе расположены несколько десятков высших учебных заведений, в том числе Уральская государственная горно-геологическая академия, Уральский государственный университет имени первого Президента России Б. Н. Ельцина, Уральский федеральный университет имени первого Президента России Б. Н. Ельцина и другие.\n\nЕкатеринбург — крупный культурный центр Урала. В городе работают несколько театров, филармония, музеи изобразительных искусств, литературный музей Ф. М. Решетникова, музей истории и археологии Урала и другие.\n\nЕкатеринбург — один из самых популярных городов-туристов в России. В городе много памятников архитектуры и истории, а также природных достопримечательностей, таких как озеро Шарташ и парк «Зеленая Роща».\n\nЕкатеринбург — город с богатой историей, восходящей к началу XVIII века. В 1723 году на берегу реки Исети был основан Екатеринбургский завод — один из старейших металлургических заводов России. В 1878 году Екатеринбург получил статус города.\n\nЕкатеринбург является членом Евразийского экономического союза и Уральского федерального округа.
```

## Просмотр логов сервера

```shell
POST /logs
```

### Параметры

- `api_key`: (обязатеное поле) токен для авторизации

## Установка и настройка

